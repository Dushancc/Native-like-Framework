var swipe,swipeH,body,bodyH,drawer,drawerH,drawerDimm,drawerDimmH,navToggle,deviceW,viewContent,burger,burgerTop,burgerBottom,topbarH,refEl;angular.module("nlFramework",[]).factory("$nlConfig",function(){return{open:!1,plusActive:!1,holdPos:null,reverse:!1,scroll:{},nlRefresh:{},options:{maxWidth:300,topBarHeight:0,speed:.2,animation:"ease",modifyViewContent:!1,useActionButton:!1,useRefresh:!0,burger:{endY:6,startScale:1,endScale:.7}}}}).factory("$nlBurger",["$nlConfig","$nlHelpers",function(e,t){return{animate:function(o){var n=e.maxWidth,i=n-Math.abs(o),r=Math.floor(100/n*i);if(r>0){var s=e.options.burger.startScale-Math.abs((1-e.options.burger.endScale)/100*r).toFixed(2),a=Math.floor(.45*r),d=Math.floor(e.options.burger.endY/100*r);d=y_pos_bottom=d<e.options.burger.endY?d:e.options.burger.endY;var l=Math.floor(1.8*r);e.options.reverse&&(l=180+(180-l)),burger.style.transition="none",burgerTop.style.transition="none",burgerBottom.style.transition="none",t.translate(burger,0,"",0,"",l,"",""),t.translate(burgerTop,0,"",d,"",a,"","",s),t.translate(burgerBottom,0,"",y_pos_bottom,"-",a,"-","",s)}},toggle:function(o){burger.style.transition="all "+e.options.speed+"s "+e.options.animation,burgerTop.style.transition="all "+e.options.speed+"s "+e.options.animation,burgerBottom.style.transition="all "+e.options.speed+"s "+e.options.animation,o?(t.translate(burgerTop,0,"",e.options.burger.endY,"",45,"","",e.options.burger.endScale),t.translate(burgerBottom,0,"",e.options.burger.endY,"-",45,"-","",e.options.burger.endScale),t.translate(burger,0,"",0,"-",180,"")):(t.translate(burgerTop,0,"",0,"",0,"","",e.options.burger.startScale),t.translate(burgerBottom,0,"",0,"",0,"","",e.options.burger.startScale),e.options.reverse?t.translate(burger,0,"",0,"-",360,""):t.translate(burger,0,"",0,"-",0,"")),setTimeout(function(){burger.style.transition="none",burgerTop.style.transition="none",burgerBottom.style.transition="none",o?e.options.reverse=!0:(t.translate(burger,0,"",0,"-",0,""),e.options.reverse=!1)},1e3*e.options.speed)}}}]).factory("$nlHelpers",function(){return{translate:function(e,t,o,n,i,r,s,a,d,l){var t=t||0,n=n||0,o=o||"",i=i||"",s=s||"",a=a||!1,d=d?"scale3d("+d+",1,1)":"",p=e;"burger-top"===p.id?p.style.transformOrigin="100% 100%":"burger-bottom"===p.id&&(p.style.transformOrigin="100% 0%"),p.style.transform="translate3d("+o+t+"px, "+i+n+"px, 0) rotate3d( 0, 0, 1, "+s+r+"deg ) "+d,p.style.webkitTransform="translate("+o+t+"px, "+i+n+"px) translateZ(0) rotate("+s+r+"deg) "+d,a&&(p.style.width=a+"px"),a&&(p.style["max-width"]=a+"px"),l&&(p.style.msTransform=p.style.MozTransform=p.style.OTransform="translateX("+o+t+"px) translateY("+i+n+"px) rotate("+s+r+"deg)")},merge:function(e,t){var o={};for(var n in e)o[n]=e[n];for(var n in t)o[n]=t[n];return o}}}).factory("$nlDrawer",["$nlConfig","$nlBurger","$nlHelpers",function(e,t,o){console.log(o);var n={show:function(){drawer.style.transition="all "+e.options.speed+"s "+e.options.animation,e.maxWidth=e.options.maxWidth>deviceW-56?deviceW-56:e.options.maxWidth,console.log(e.maxWidth),o.translate(drawer,0,"",0,"",0,"",e.maxWidth),drawerDimm.style.transition="all "+e.options.speed+"s "+e.options.animation,drawerDimm.style.visibility="visible",drawerDimm.style.opacity="1",e.options.open=!0,e.options.reverse=!0,t.toggle(!0)},hide:function(){drawer.style.transition="all "+e.options.speed+"s "+e.options.animation,o.translate(drawer,e.maxWidth,"-",0,"",0,""),drawerDimm.style.transition="all "+e.options.speed+"s "+e.options.animation,drawerDimm.style.visibility="hidden",drawerDimm.style.opacity="0",e.options.open&&t.toggle(!1),e.options.open=!1},toggle:function(){e.options.open?n.hide():n.show()},move:function(i,r){e.options.direction="panleft"===i.type?"left":"right";var s=i.center.x-e.maxWidth;r&&(e.options.holdPos=e.options.holdPos?e.options.holdPos:s,s+=Math.abs(e.options.holdPos)),s=0>s?s:0;var a=e.options.maxWidth-Math.abs(s),d=(a/(e.options.maxWidth/100)/100).toFixed(2);d=1>d?d:1,t.animate(s),drawerDimm.style.visibility="visible",drawerDimm.style.opacity=d,drawerDimm.style.webkitTransform="translate(0,0) translateZ(0)",drawer.style.transition="none",e.maxWidth=e.options.maxWidth>deviceW-56?deviceW-56:e.options.maxWidth,o.translate(drawer,s,"",0,"",0,"",e.maxWidth),e.options.open=!0,i.isFinal?("left"===e.options.direction?n.hide():n.show(),e.options.holdPos=null,e.options.endTrue=!1):e.options.endTrue=!0},touchEnd:function(t){var o="ontouchstart"in window?!0:!1;o?t.addEventListener("touchend",function(e){i(e,!0)},!1):t.addEventListener("mouseup",function(e){i(e,!1)},!1);var i=function(t,o){var i=o?t.changedTouches[0]:t,r=i.clientX>e.options.maxWidth/2,s="left"===e.options.direction,a="right"===e.options.direction,d=e.options.endTrue;r&&s&&d||r&&a&&d?n.show():(!r&&s&&d||!r&&a&&d)&&n.hide(),e.options.direction=!1,e.options.endTrue=!1,e.options.holdPos=null,t.preventDefault()}},init:function(t){e.options=o.merge(e.options,t),console.log("init drawer"),swipe=document.getElementById("swipe-stripe"),swipeH=new Hammer(swipe),body=document.getElementById("cont"),bodyH=new Hammer(body),drawer=document.getElementById("drawer"),drawerH=new Hammer(drawer),drawerDimm=document.getElementById("drawer-dimm"),drawerDimmH=new Hammer(drawerDimm),topbar=document.getElementById("topbar"),topbarH=new Hammer(topbar),burger=document.getElementById("burger"),burgerTop=document.getElementById("burger-top"),burgerBottom=document.getElementById("burger-bottom"),refEl=document.getElementById("nlRefresh"),deviceW=Math.max(document.documentElement.clientWidth,window.innerWidth||0),deviceH=Math.max(document.documentElement.clientHeight,window.innerHeight||0),e.options.modifyViewContent&&(viewContent=document.getElementById("view-content"),viewContent.style.position="fixed",viewContent.style.width=deviceW+"px",viewContent.style.height=deviceH-e.options.topBarHeight+"px",viewContent.style.top=e.options.topBarHeight+"px"),e.maxWidth=e.options.maxWidth>deviceW-56?deviceW-56:e.options.maxWidth,o.translate(drawer,e.maxWidth,"-",0,"",0,"",e.maxWidth),window.onresize=function(t){deviceW=Math.max(document.documentElement.clientWidth,window.innerWidth||0),deviceH=Math.max(document.documentElement.clientHeight,window.innerHeight||0),e.options.modifyViewContent&&(viewContent.style.position="fixed",viewContent.style.width=deviceW+"px",viewContent.style.height=deviceH-e.options.topBarHeight+"px"),e.maxWidth=e.options.maxWidth>deviceW-56?deviceW-56:e.options.maxWidth,e.options.open?o.translate(drawer,0,"",0,"",0,"",e.maxWidth):o.translate(drawer,e.maxWidth,"-",0,"",0,"",e.maxWidth)},drawerH.on("panleft panright",function(t){e.options.open&&n.move(t,!0)}),drawerDimmH.on("panleft panright",function(t){e.options.open&&n.move(t)}),swipeH.on("panright panleft",function(e){n.move(e)}),n.touchEnd(swipe),n.touchEnd(drawer),n.touchEnd(drawerDimm)},set:function(t){var n=e.options;e.options=o.merge(n,t)},togglePlus:function(t){if(e.options.useActionButton){var o=document.getElementById("add-panel-switch"),i=document.getElementById("drawer-dimm");n.plusActive||t?(e.options.open||(i.style.visibility="hidden",i.style.opacity="0"),n.plusActive=!1,o.classList.remove("active")):(n.plusActive=!0,o.classList.add("active"),i.style.visibility="visible",i.style.opacity="1")}}};return n}]).factory("$nlRefresh",["$nlConfig","$nlHelpers",function(e,t){var o={init:function(){e.scroll.top=0,window.addEventListener("scroll",function(t){e.scroll.top=window.pageYOffset||document.documentElement.scrollTop,e.scroll.left=window.pageXOffset||document.documentElement.scrollLeft},!1),topbarH.on("pandown panup",function(o){if(e.scroll.top<1){e.nlRefresh.direction="panup"===o.type?"up":"down",refEl.style["z-index"]="1100";var n=Math.floor(deviceH/4);console.log("end",n);var i=100/deviceH*o.center.y;i=i*(n/100)+e.options.topBarHeight,console.log("pos",i),t.translate(refEl,0,"",i,"",0,"")}})}};return o}]);